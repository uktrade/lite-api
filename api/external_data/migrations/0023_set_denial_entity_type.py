# Generated by Django 4.2.11 on 2024-04-18 12:00

from django.db import migrations


def get_denial_entity_type(data):
    entity_type = ""
    for key in ["end_user_flag", "consignee_flag", "other_role"]:
        if data.get(key) and isinstance(data[key], str):
            data[key] = data[key].lower() == "true"
    if data.get("end_user_flag", False) is True:
        entity_type = "End-user"
    elif data.get("end_user_flag", False) is False and data.get("consignee_flag", False) is True:
        entity_type = "Consignee"
    elif (
        data.get("end_user_flag", False) is False
        and data.get("consignee_flag", False) is False
        and data.get("other_role", False) is True
    ):
        entity_type = "Third-party"
    return entity_type


def set_denial_entity_type(apps, schema_editor):

    DenialEntity = apps.get_model("external_data", "DenialEntity")

    for denial_entity in DenialEntity.objects.all():
        denial_entity.entity_type = get_denial_entity_type(denial_entity.entity_type)
        denial_entity.save()


class Migration(migrations.Migration):

    dependencies = [
        ("external_data", "0022_denialentity_entity_type"),
    ]

    operations = [migrations.RunPython(set_denial_entity_type, migrations.RunPython.noop)]
