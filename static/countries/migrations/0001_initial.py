# Generated by Django 2.2 on 2019-05-08 14:45
import csv

from django.db import migrations, models


def initialize(apps, schema_editor):
    # We can't import the Queue model directly as it may be a newer
    # version than this migration expects. We use the historical version.
    Country = apps.get_model("countries", "Country")
    if not Country.objects.all():
        with open("lite-content/lite-api/countries.csv", newline="") as csvfile:
            reader = csv.reader(csvfile, delimiter=",", quotechar='"')
            next(reader, None)  # skip the headers
            for row in reader:
                country = Country(id=row[1], name=row[0], type=row[2])
                country.save()


def destroy(apps, schema_editor):
    Country = apps.get_model("countries", "Country")
    if Country.objects.all():
        Country.objects.all().delete()


class Migration(migrations.Migration):

    initial = True

    dependencies = []

    operations = [
        migrations.CreateModel(
            name="Country",
            fields=[
                ("id", models.CharField(primary_key=True, max_length=100)),
                ("name", models.CharField(max_length=100)),
                ("type", models.CharField(max_length=100)),
            ],
        ),
        migrations.RunPython(initialize, destroy),
    ]
